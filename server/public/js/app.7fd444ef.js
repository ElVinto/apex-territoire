(function(e){function t(t){for(var a,o,i=t[0],u=t[1],c=t[2],h=0,p=[];h<i.length;h++)o=i[h],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&p.push(n[o][0]),n[o]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);l&&l(t);while(p.length)p.shift()();return s.push.apply(s,c||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],a=!0,i=1;i<r.length;i++){var u=r[i];0!==n[u]&&(a=!1)}a&&(s.splice(t--,1),e=o(o.s=r[0]))}return e}var a={},n={app:0},s=[];function o(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=a,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(r,a,function(t){return e[t]}.bind(null,a));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=u;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var a=r("85ec"),n=r.n(a);n.a},"33e0":function(e,t,r){"use strict";var a=r("77d4"),n=r.n(a);n.a},"4a6d":function(e,t,r){"use strict";var a=r("84f9"),n=r.n(a);n.a},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),n=r("2f62");a["a"].use(n["a"]);var s=new n["a"].Store({state:{loggedUserEmail:"baptiste.oger@supagro.fr",userDataObj:null,selectedParcelIdx:null,selectedYearIdx:null,selectedWeekIdx:null,userUpdateWeekMetrics:null},getters:{},mutations:{initUserDataObj:function(e,t){e.userDataObj=t},changeSelectedYear:function(e,t){e.selectedYearNumber=t},changeSelectedWeekNumber:function(e,t){e.selectedWeekNumber=t}},actions:{}}),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("Menu",{attrs:{msg:"Place the menu here"}}),r("hr"),r("ApexMap"),r("hr"),r("Footer")],1)},i=[],u=(r("96cf"),r("1da1")),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"menu"},[r("h1",[e._v(e._s(e.msg))])])},l=[],h={name:"Menu",props:{msg:String},data:function(){return{tabs:["map","summary","export"]}}},p=h,f=(r("d50c"),r("2877")),v=Object(f["a"])(p,c,l,!1,null,"1e479e26",null),b=v.exports,d=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"apex-map"},[null!==e.$store.state.userDataObj?r("div",{staticClass:"parcels-container"},[r("h1",[e._v(" usermail "+e._s(e.$store.state.loggedUserEmail)+" ")]),e._l(e.$store.state.userDataObj.parcels,(function(t,a){return r("div",{key:t.parcelName,staticClass:"parcels",attrs:{item:t,index:a}},[r("p",{staticClass:"text"},[e._v(e._s("parcelName: "+t.parcelName+" parcelOwner: "+t.parcelOwner+" monitored years:["+t.parcelYears+"]"))])])}))],2):e._e()])},w=[],g=(r("99af"),r("7db0"),r("4160"),r("d3b7"),r("25f0"),r("159b"),r("d4ec")),m=r("bee2"),k=r("7338"),y=r.n(k);r("ed18").config();var O="db-services";var D=function(){function e(){Object(g["a"])(this,e)}return Object(m["a"])(e,null,[{key:"getObservations",value:function(e){return console.log("getObservations from "+e),new Promise((function(t,r){try{var a={params:{useremail:e}};y.a.get(O,a).then((function(e){t(e.data)}))}catch(n){r(n)}}))}},{key:"postQuery",value:function(e){return y.a.post(O,e)}},{key:"deleteQuery",value:function(e){return y.a.delete(O,e)}},{key:"getMonthLabel",value:function(e){switch(e){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec";default:return}}},{key:"getDayLabel",value:function(e){switch(e){case"1":return"Mon";case"2":return"Tue";case"3":return"Wed";case"4":return"Thu";case"5":return"Fri";case"6":return"Sat";case"0":return"Sun";default:return}}},{key:"extractUserDataObjFrom",value:function(t){console.log("extractUserDataObjFrom : nbRows: "+t.length);var r={};return t.forEach((function(t){void 0===r.userEMail&&(r=new e.MonitoredUser(t.userEMail,t.userId,t.userName));var a=r.parcels.find((function(e){return e.parcelName===t.parcelName}));void 0===a&&(a=new e.MonitoredParcel(t.parcelName,t.userEMail,t.userName,t.userId,{lat:t.parcelLat,lng:t.parcelLng}),r.parcels.push(a));var n=new Date;n.setTime(t.sessionDateInSec+"000");var s=n.getFullYear(),o=a.parcelYears.find((function(e){return e.yearNumber===s}));void 0===o&&(o=new e.MonitoredYear(s),a.parcelYears.push(o));var i=new Date(s,0,1),u=864e5,c=u*(1===i.getDay()?0:0===i.getDay()?1:8-i.getDay()),l=new Date;l.setTime(i.getTime()+c);var h=n.getTime()===l.getTime()?1:Math.ceil((n.getTime()-l.getTime())/u/7),p=n.getTime()-u*(1===n.getDay()?0:0===n.getDay()?6:n.getDay()-1),f=new Date;f.setTime(p);var v=o.yearWeeks.find((function(e){return e.weekNumber===h}));void 0===v&&(v=new e.MonitoredWeek(t.sessionDateInSec+"000"),o.yearWeeks.push(v));var b=v.weekSessions.find((function(e){return e.sessionDateInMs===t.sessionDateInSec+"000"}));void 0===b&&(b=new e.MonitoredSession(t.sessionDateInSec+"000"),v.weekSessions.push(b));var d=new e.MonitoredObservation(t.obsvLabel,t.obsvDateInMs,t.userName,t.userName,{lat:t.obsvLat,lng:t.obsvLng});b.sessionObservations.push(d)})),r}},{key:"addWeeksToUserDataObj",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2018,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2019,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:22,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:32;if(console.log("addWeeksToUserDataObj "),void 0===t.parcels)throw" No parcels is currently monitored by the user";for(var o=[],i=[],u=0;u<t.parcels.length;u++){var c=t.parcels[u];if(void 0!==c.parcelYears)for(var l=function(e){var t=c.parcelYears[e].yearNumber;void 0===o.find((function(e){return e===t}))&&o.push(t)},h=0;h<c.parcelYears.length;h++)l(h);for(var p=function(e){void 0===o.find((function(t){return t===e}))&&o.push(e)},f=r;f<=a;f++)p(f);if(void 0!==c.parcelYears)for(var v=0;v<c.parcelYears.length;v++)if(void 0!==c.parcelYears[v].yearWeeks)for(var b=function(e){var t=c.parcelYears[v].yearWeeks[e].weekNumber;void 0===i.find((function(e){return e===t}))&&i.push(t)},d=0;d<c.parcelYears[v].yearWeeks.length;d++)b(d);for(var w=function(e){void 0===i.find((function(t){return t===e}))&&i.push(e)},g=n;g<=s;g++)w(g)}for(var m=0;m<t.parcels.length;m++)for(var k=t.parcels[m],y=function(t){var r=o[t],a=k.parcelYears.find((function(e){return e.yearNumber===r}));void 0===a&&(a=new e.MonitoredYear(r),k.parcelYears.push(a));for(var n=function(t){var n=i[t],s=a.yearWeeks.find((function(e){return e.weekNumber===n}));void 0===s&&(s=new e.MonitoredWeek(r,n),a.yearWeeks.push(s))},s=0;s<i.length;s++)n(s)},O=0;O<o.length;O++)y(O)}},{key:"enforceConsistencyOfUserDataObj",value:function(e){if(console.log("enforceConsistencyOfUserDataObj "),void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var t=0;t<e.parcels.length;t++){var r=e.parcels[t];if(void 0!==r.parcelYears&&r.parcelYears.length>0)for(var a=0;a<r.parcelYears.length;a++){var n=r.parcelYears[a];if(void 0!==n.yearWeeks&&n.yearWeeks.length>0)for(var s=0;s<n.yearWeeks.length;s++){var o=n.yearWeeks[s];if(void 0!==o.weekSessions&&o.weekSessions.length>0){var i=0,u=0,c=0,l=0,h=0;this.weekICApex=0;for(var p=0;p<o.weekSessions.length;p++){var f=o.weekSessions[p],v=0,b=0;if(void 0!==f.sessionObservations){for(var d=0;d<f.sessionObservations.length;d++){var w=f.sessionObservations[d];"P"===w.obsvLabel&&c++,"R"===w.obsvLabel&&l++,"C"===w.obsvLabel&&h++,v+=w.obsvValue,b++,u+=w.obsvValue,i++}b>0&&(f.sessionAVGrowth=v/b)}}o.weekNbObservations=i,o.weekNbObsFullGrowth=c,o.weekNbObsSlowGrowth=l,o.weekNbObsStoppedGrowth=h,o.weekAVGrowth=Math.round(100*u/i)/100,o.weekPrctFullGrowth=Math.round(1e4*c/i)/100,o.weekPrctSlowGrowth=Math.round(1e4*l/i)/100,o.weekPrctStoppedGrowth=Math.round(1e4*h/i)/100,o.weekICApex=o.reInitICApex()}}}}}},{key:"sortUserDataObjByYearByWeek",value:function(e){if(void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var t=0;t<e.parcels.length;t++){var r=e.parcels[t];if(void 0!==r.parcelYears&&r.parcelYears.length>0){for(var a=0;a<r.parcelYears.length;a++){var n=r.parcelYears[a];void 0!==n.yearWeeks&&n.yearWeeks.length>0&&n.yearWeeks.sort((function(e,t){return e.weekNumber-t.weekNumber}))}r.parcelYears.sort((function(e,t){return e.yearNumber-t.yearNumber}))}}}},{key:"MonitoredUser",value:function(e,t,r){var a=this;this.userEMail=e,this.userId=t,this.userName=r,this.parcels=[],this.toString=function(){return"user: email ".concat(a.userEMail," id: ").concat(a.userId," name ").concat(a.userName)}}},{key:"MonitoredParcel",value:function(e,t,r,a,n){var s=this;this.parcelName=e,this.parcelUserEMail=t,this.parcelUserName=r,this.parcelUserId=a,this.parcelCoord=n,this.parcelYears=[],this.toString=function(){return"parcel: "+s.parcelName}}},{key:"MonitoredYear",value:function(e){this.yearNumber=e,this.yearWeeks=[],this.toString=function(){return"year: ".concat(this.yearNumber)}}},{key:"MonitoredWeek",value:function(t,r){var a=this;if(this.weekNumber=0,this.weekLabel="",this.weekFullDate=new Date,this.weekSessions=[],this.weekNbObservations=0,this.weekNbObsFullGrowth=0,this.weekNbObsSlowGrowth=0,this.weekNbObsStoppedGrowth=0,this.weekPrctFullGrowth=0,this.weekPrctSlowGrowth=0,this.weekPrctStoppedGrowth=0,this.weekAVGrowth=0,this.weekICApex=0,this.toString=function(){return"w"+a.weekNumber+"("+a.weekLabel+")"},void 0===r){var n=t,s=new Date;s.setTime(n);var o=new Date(s.getFullYear(),0,1),i=864e5,u=i*(1===o.getDay()?0:0===o.getDay()?1:8-o.getDay()),c=new Date;c.setTime(o.getTime()+u);var l=s.getTime()===c.getTime()?1:Math.ceil((s.getTime()-c.getTime())/i/7),h=s.getTime()-i*(1===s.getDay()?0:0===s.getDay()?6:s.getDay()-1),p=new Date;p.setTime(h);var f=p.getDate()+" "+e.getMonthLabel(p.getMonth());this.weekNumber=l,this.weekLabel=f,this.weekFullDate=p.toString()}else{var v=t,b=r,d=new Date(v,0,1),w=864e5,g=w*(1===d.getDay()?0:0===d.getDay()?1:8-d.getDay()),m=new Date;m.setTime(d.getTime()+g);var k=m.getTime()+7*w*(b-1),y=new Date;y.setTime(k);var O=y.getDate()+" "+e.getMonthLabel(y.getMonth());this.weekNumber=b,this.weekLabel=O,this.weekFullDate=y.toString()}this.reInitICApex=function(){var e=3;return this.weekAVGrowth>=.75?e=0:this.weekPrctFullGrowth>=5?e=1:this.weekPrctSlowGrowth<=90&&(e=2),e}}},{key:"MonitoredSession",value:function(t){var r=new Date;r.setTime(t),this.sessionDateInMs=t,this.sessionDateLabel=r.getDate()+" "+e.getMonthLabel(r.getMonth())+" "+r.getFullYear(),this.sessionAVGrowth=0,this.sessionICApex=0,this.sessionObservations=[]}},{key:"MonitoredObservation",value:function(e,t,r,a,n){this.initObsvValueFromLabel=function(e){switch(e){case"P":return 1;case"R":return.5;case"C":return 0;default:return}},this.obsvLabel=e,this.obsvValue=this.initObsvValueFromLabel(e),this.obsvDateInMs=t,this.obsvOwnerName=r,this.obsvUserName=a,this.obsvCoord=n}}]),e}(),N=D,M={name:"ApexMap",data:function(){return{error:"",text:""}},methods:{updateWeekMetrics:function(e,t,r){var a=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,N.postQuery({transaction:"update_WeekMetrics",userId:e.parcelUserId,parcelId:e.parcelDBId,yearNumber:t.yearNumber,weekNumber:r.weekNumber,weekLabel:r.weekLabel,nbObservations:r.weekNbObservations,nbObsFullGrowth:r.weekNbObsFullGrowth,nbObsSlowGrowth:r.weekNbObsSlowGrowth,nbObsStoppedGrowth:r.weekNbObsStoppedGrowth,metricsDateInMs:(new Date).getTime()});case 2:return n.next=4,N.getObservations();case 4:a.posts=n.sent;case 5:case"end":return n.stop()}}),n)})))()}}},S=M,x=(r("4a6d"),Object(f["a"])(S,d,w,!1,null,"59bf7225",null)),j=x.exports,Y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"footer"},[a("h1",[e._v(e._s(e.msg))]),a("img",{attrs:{alt:"Vue logo",src:r("cf05")}})])},T=[],W={name:"Footer",data:function(){return{msg:"Place the footer here"}}},I=W,G=(r("33e0"),Object(f["a"])(I,Y,T,!1,null,"2e9ae21c",null)),_=G.exports,U={name:"App",components:{Menu:b,ApexMap:j,Footer:_},created:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,N.getObservations(e.$store.state.loggedUserEmail);case 3:r=t.sent,a=N.extractUserDataObjFrom(r),N.addWeeksToUserDataObj(a),N.enforceConsistencyOfUserDataObj(a),N.sortUserDataObjByYearByWeek(a),e.$store.commit("initUserDataObj",a),console.log("updated $store.state.userDataObj: "),console.log(e.$store.state.userDataObj),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),e.error=t.t0.message;case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()}},F=U,L=(r("034f"),Object(f["a"])(F,o,i,!1,null,null,null)),P=L.exports;a["a"].config.productionTip=!1,new a["a"]({store:s,render:function(e){return e(P)}}).$mount("#app")},"77d4":function(e,t,r){},"84f9":function(e,t,r){},"85ec":function(e,t,r){},bded:function(e,t,r){},cf05:function(e,t,r){e.exports=r.p+"img/logo.82b9c7a5.png"},d50c:function(e,t,r){"use strict";var a=r("bded"),n=r.n(a);n.a}});
//# sourceMappingURL=app.7fd444ef.js.map