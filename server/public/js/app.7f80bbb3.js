(function(e){function t(t){for(var a,o,i=t[0],c=t[1],l=t[2],d=0,p=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(p.length)p.shift()();return n.push.apply(n,l||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],a=!0,i=1;i<r.length;i++){var c=r[i];0!==s[c]&&(a=!1)}a&&(n.splice(t--,1),e=o(o.s=r[0]))}return e}var a={},s={app:0},n=[];function o(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=a,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(r,a,function(t){return e[t]}.bind(null,a));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=c;n.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var a=r("85ec"),s=r.n(a);s.a},"33e0":function(e,t,r){"use strict";var a=r("77d4"),s=r.n(a);s.a},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),s=(r("d81d"),r("2f62"));a["a"].use(s["a"]);var n=new s["a"].Store({state:{loggedUserEmail:"Toto@tu.ti",userDataObj:null,selectedParcelIdx:0,selectedYearIdx:0,selectedWeekIdx:0,userUpdateWeekMetrics:null},getters:{parcelNameList:function(e){return null!==e.userDataObj&&null!==e.userDataObj.parcels?e.userDataObj.parcels.map((function(e){return e.parcelName})):[]},yearNumberList:function(e){return null!==e.userDataObj&&null!==e.userDataObj.parcels[e.selectedParcelIdx]?e.userDataObj.parcels[e.selectedParcelIdx].parcelYears.map((function(e){return e.yearNumber})):[]},weekLabelList:function(e){return null!==e.userDataObj&&null!==e.userDataObj.parcels[e.selectedParcelIdx]&&null!==e.userDataObj.parcels[e.selectedParcelIdx].parcelYears[e.selectedYearIdx]&&null!==e.userDataObj.parcels[e.selectedParcelIdx].parcelYears[e.selectedYearIdx].yearWeeks?e.userDataObj.parcels[e.selectedParcelIdx].parcelYears[e.selectedYearIdx].yearWeeks.map((function(e){return e.weekLabel})):[]}},mutations:{initLoggedUserEmail:function(e,t){e.loggedUserEmail=t},initUserDataObj:function(e,t){e.userDataObj=t},updateSelectedParcelIdx:function(e,t){e.selectedParcelIdx=t},updateSelectedYearIdx:function(e,t){e.selectedYearIdx=t},updateSelectedWeekNumberIdx:function(e,t){e.selectedWeekIdx=t}},actions:{}}),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!==e.$store.state.userDataObj?r("div",{attrs:{id:"app"}},[[r("Menu",{attrs:{msg:"Place the menu here"}}),r("hr"),r("ApexMap"),r("hr"),r("Footer")]],2):e._e()},i=[],c=(r("96cf"),r("1da1")),l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"menu"},[r("h1",[e._v(e._s(e.msg))])])},u=[],d={name:"Menu",props:{msg:String},data:function(){return{tabs:["map","summary","export"]}}},p=d,h=(r("d50c"),r("2877")),v=Object(h["a"])(p,l,u,!1,null,"1e479e26",null),f=v.exports,b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"apex-map"},[null!==e.$store.state.userDataObj?r("div",{staticClass:"parcels-container"},[r("h1",[e._v(" usermail "+e._s(e.$store.state.loggedUserEmail)+" ")]),e._l(e.$store.state.userDataObj.parcels,(function(t,a){return r("div",{key:t.parcelName,staticClass:"parcels",attrs:{item:t,index:a}},[r("p",{staticClass:"text"},[e._v(e._s("parcelName: "+t.parcelName+" parcelOwner: "+t.parcelOwner+" monitored years:["+t.parcelYears+"]"))])])}))],2):e._e(),null!==e.$store.state.userDataObj?r("div",{staticClass:"parcelNames-container"},[r("h1",[e._v(" Parcel Name List from Store")]),e._l(e.$store.getters.parcelNameList,(function(t,a){return r("div",{key:t,staticClass:"userParcelNames",attrs:{item:t,index:a}},[r("p",{staticClass:"text"},[e._v(e._s("parcelName: "+t))])])}))],2):e._e(),null!==e.$store.state.userDataObj?r("div",{staticClass:"parcelNames-container"},[r("h1",[e._v(" year Numbers list from Store ")]),e._l(e.$store.getters.yearNumberList,(function(t,a){return r("div",{key:t,staticClass:"userParcelNames",attrs:{item:t,index:a}},[r("p",{staticClass:"text"},[e._v(e._s("yearNumber: "+t))])])}))],2):e._e(),null!==e.$store.state.userDataObj?r("div",{staticClass:"parcelNames-container"},[r("h1",[e._v(" week Label list from Store ")]),e._l(e.$store.getters.weekLabelList,(function(t,a){return r("div",{key:t,staticClass:"userParcelNames",attrs:{item:t,index:a}},[r("p",{staticClass:"text"},[e._v(e._s("wLabel: "+t))])])}))],2):e._e()])},m=[],w=(r("99af"),r("7db0"),r("4160"),r("d3b7"),r("25f0"),r("159b"),r("d4ec")),g=r("bee2"),k=r("7338"),y=r.n(k);r("ed18").config();var O="db-services";var D=function(){function e(){Object(w["a"])(this,e)}return Object(g["a"])(e,null,[{key:"checkEMail",value:function(e){console.log("Checking email of "+e);var t={transaction:"select_useremail",useremail:e};return new Promise((function(r,a){try{y.a.post(O+"/login",t).then((function(t){void 0!==t.data&&t.data.length>0?r(t.data[0].email===e):r(!1)}))}catch(s){a(s)}}))}},{key:"getObservations",value:function(e){return console.log("getObservations from "+e),new Promise((function(t,r){try{var a={transaction:"select_observations",useremail:e};y.a.post(O,a).then((function(e){t(e.data)}))}catch(s){r(s)}}))}},{key:"getObservationsBis",value:function(e){var t={transaction:"select_observations",useremail:e};this.postQuery(t).then((function(e){return e.data?e.data:e}))}},{key:"postQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.url,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(r,a){try{y.a.post(e,t).then((function(e){r(e)}))}catch(s){a(s)}}))}},{key:"deleteQuery",value:function(e){return y.a.delete(O,e)}},{key:"getMonthLabel",value:function(e){switch(e){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec";default:return}}},{key:"getDayLabel",value:function(e){switch(e){case"1":return"Mon";case"2":return"Tue";case"3":return"Wed";case"4":return"Thu";case"5":return"Fri";case"6":return"Sat";case"0":return"Sun";default:return}}},{key:"extractUserDataObjFrom",value:function(t){console.log("extractUserDataObjFrom : nbRows: "+t.length);var r={};return t.forEach((function(t){void 0===r.userEMail&&(r=new e.MonitoredUser(t.userEMail,t.userId,t.userName));var a=r.parcels.find((function(e){return e.parcelName===t.parcelName}));void 0===a&&(a=new e.MonitoredParcel(t.parcelName,t.userEMail,t.userName,t.userId,{lat:t.parcelLat,lng:t.parcelLng}),r.parcels.push(a));var s=new Date;s.setTime(t.sessionDateInSec+"000");var n=s.getFullYear(),o=a.parcelYears.find((function(e){return e.yearNumber===n}));void 0===o&&(o=new e.MonitoredYear(n),a.parcelYears.push(o));var i=new Date(n,0,1),c=864e5,l=c*(1===i.getDay()?0:0===i.getDay()?1:8-i.getDay()),u=new Date;u.setTime(i.getTime()+l);var d=s.getTime()===u.getTime()?1:Math.ceil((s.getTime()-u.getTime())/c/7),p=s.getTime()-c*(1===s.getDay()?0:0===s.getDay()?6:s.getDay()-1),h=new Date;h.setTime(p);var v=o.yearWeeks.find((function(e){return e.weekNumber===d}));void 0===v&&(v=new e.MonitoredWeek(t.sessionDateInSec+"000"),o.yearWeeks.push(v));var f=v.weekSessions.find((function(e){return e.sessionDateInMs===t.sessionDateInSec+"000"}));void 0===f&&(f=new e.MonitoredSession(t.sessionDateInSec+"000"),v.weekSessions.push(f));var b=new e.MonitoredObservation(t.obsvLabel,t.obsvDateInMs,t.userName,t.userName,{lat:t.obsvLat,lng:t.obsvLng});f.sessionObservations.push(b)})),r}},{key:"addWeeksToUserDataObj",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2018,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2019,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:22,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:32;if(console.log("addWeeksToUserDataObj "),void 0===t.parcels)throw" No parcels is currently monitored by the user";for(var o=[],i=[],c=0;c<t.parcels.length;c++){var l=t.parcels[c];if(void 0!==l.parcelYears)for(var u=function(e){var t=l.parcelYears[e].yearNumber;void 0===o.find((function(e){return e===t}))&&o.push(t)},d=0;d<l.parcelYears.length;d++)u(d);for(var p=function(e){void 0===o.find((function(t){return t===e}))&&o.push(e)},h=r;h<=a;h++)p(h);if(void 0!==l.parcelYears)for(var v=0;v<l.parcelYears.length;v++)if(void 0!==l.parcelYears[v].yearWeeks)for(var f=function(e){var t=l.parcelYears[v].yearWeeks[e].weekNumber;void 0===i.find((function(e){return e===t}))&&i.push(t)},b=0;b<l.parcelYears[v].yearWeeks.length;b++)f(b);for(var m=function(e){void 0===i.find((function(t){return t===e}))&&i.push(e)},w=s;w<=n;w++)m(w)}for(var g=0;g<t.parcels.length;g++)for(var k=t.parcels[g],y=function(t){var r=o[t],a=k.parcelYears.find((function(e){return e.yearNumber===r}));void 0===a&&(a=new e.MonitoredYear(r),k.parcelYears.push(a));for(var s=function(t){var s=i[t],n=a.yearWeeks.find((function(e){return e.weekNumber===s}));void 0===n&&(n=new e.MonitoredWeek(r,s),a.yearWeeks.push(n))},n=0;n<i.length;n++)s(n)},O=0;O<o.length;O++)y(O)}},{key:"enforceConsistencyOfUserDataObj",value:function(e){if(console.log("enforceConsistencyOfUserDataObj "),void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var t=0;t<e.parcels.length;t++){var r=e.parcels[t];if(void 0!==r.parcelYears&&r.parcelYears.length>0)for(var a=0;a<r.parcelYears.length;a++){var s=r.parcelYears[a];if(void 0!==s.yearWeeks&&s.yearWeeks.length>0)for(var n=0;n<s.yearWeeks.length;n++){var o=s.yearWeeks[n];if(void 0!==o.weekSessions&&o.weekSessions.length>0){var i=0,c=0,l=0,u=0,d=0;this.weekICApex=0;for(var p=0;p<o.weekSessions.length;p++){var h=o.weekSessions[p],v=0,f=0;if(void 0!==h.sessionObservations){for(var b=0;b<h.sessionObservations.length;b++){var m=h.sessionObservations[b];"P"===m.obsvLabel&&l++,"R"===m.obsvLabel&&u++,"C"===m.obsvLabel&&d++,v+=m.obsvValue,f++,c+=m.obsvValue,i++}f>0&&(h.sessionAVGrowth=v/f)}}o.weekNbObservations=i,o.weekNbObsFullGrowth=l,o.weekNbObsSlowGrowth=u,o.weekNbObsStoppedGrowth=d,o.weekAVGrowth=Math.round(100*c/i)/100,o.weekPrctFullGrowth=Math.round(1e4*l/i)/100,o.weekPrctSlowGrowth=Math.round(1e4*u/i)/100,o.weekPrctStoppedGrowth=Math.round(1e4*d/i)/100,o.weekICApex=o.reInitICApex()}}}}}},{key:"sortUserDataObjByYearByWeek",value:function(e){if(void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var t=0;t<e.parcels.length;t++){var r=e.parcels[t];if(void 0!==r.parcelYears&&r.parcelYears.length>0){for(var a=0;a<r.parcelYears.length;a++){var s=r.parcelYears[a];void 0!==s.yearWeeks&&s.yearWeeks.length>0&&s.yearWeeks.sort((function(e,t){return e.weekNumber-t.weekNumber}))}r.parcelYears.sort((function(e,t){return e.yearNumber-t.yearNumber}))}}}},{key:"MonitoredUser",value:function(e,t,r){var a=this;this.userEMail=e,this.userId=t,this.userName=r,this.parcels=[],this.toString=function(){return"user: email ".concat(a.userEMail," id: ").concat(a.userId," name ").concat(a.userName)}}},{key:"MonitoredParcel",value:function(e,t,r,a,s){var n=this;this.parcelName=e,this.parcelUserEMail=t,this.parcelUserName=r,this.parcelUserId=a,this.parcelCoord=s,this.parcelYears=[],this.toString=function(){return"parcel: "+n.parcelName}}},{key:"MonitoredYear",value:function(e){this.yearNumber=e,this.yearWeeks=[],this.toString=function(){return"year: ".concat(this.yearNumber)}}},{key:"MonitoredWeek",value:function(t,r){var a=this;if(this.weekNumber=0,this.weekLabel="",this.weekFullDate=new Date,this.weekSessions=[],this.weekNbObservations=0,this.weekNbObsFullGrowth=0,this.weekNbObsSlowGrowth=0,this.weekNbObsStoppedGrowth=0,this.weekPrctFullGrowth=0,this.weekPrctSlowGrowth=0,this.weekPrctStoppedGrowth=0,this.weekAVGrowth=0,this.weekICApex=0,this.toString=function(){return"w"+a.weekNumber+"("+a.weekLabel+")"},void 0===r){var s=t,n=new Date;n.setTime(s);var o=new Date(n.getFullYear(),0,1),i=864e5,c=i*(1===o.getDay()?0:0===o.getDay()?1:8-o.getDay()),l=new Date;l.setTime(o.getTime()+c);var u=n.getTime()===l.getTime()?1:Math.ceil((n.getTime()-l.getTime())/i/7),d=n.getTime()-i*(1===n.getDay()?0:0===n.getDay()?6:n.getDay()-1),p=new Date;p.setTime(d);var h=p.getDate()+" "+e.getMonthLabel(p.getMonth());this.weekNumber=u,this.weekLabel=h,this.weekFullDate=p.toString()}else{var v=t,f=r,b=new Date(v,0,1),m=864e5,w=m*(1===b.getDay()?0:0===b.getDay()?1:8-b.getDay()),g=new Date;g.setTime(b.getTime()+w);var k=g.getTime()+7*m*(f-1),y=new Date;y.setTime(k);var O=y.getDate()+" "+e.getMonthLabel(y.getMonth());this.weekNumber=f,this.weekLabel=O,this.weekFullDate=y.toString()}this.reInitICApex=function(){var e=3;return this.weekAVGrowth>=.75?e=0:this.weekPrctFullGrowth>=5?e=1:this.weekPrctSlowGrowth<=90&&(e=2),e}}},{key:"MonitoredSession",value:function(t){var r=new Date;r.setTime(t),this.sessionDateInMs=t,this.sessionDateLabel=r.getDate()+" "+e.getMonthLabel(r.getMonth())+" "+r.getFullYear(),this.sessionAVGrowth=0,this.sessionICApex=0,this.sessionObservations=[]}},{key:"MonitoredObservation",value:function(e,t,r,a,s){this.initObsvValueFromLabel=function(e){switch(e){case"P":return 1;case"R":return.5;case"C":return 0;default:return}},this.obsvLabel=e,this.obsvValue=this.initObsvValueFromLabel(e),this.obsvDateInMs=t,this.obsvOwnerName=r,this.obsvUserName=a,this.obsvCoord=s}}]),e}(),N=D,x={name:"ApexMap",data:function(){return{error:"",text:""}},computed:{},methods:{updateWeekMetrics:function(e,t,r){var a=this;return Object(c["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,N.postQuery({transaction:"update_WeekMetrics",userId:e.parcelUserId,parcelId:e.parcelDBId,yearNumber:t.yearNumber,weekNumber:r.weekNumber,weekLabel:r.weekLabel,nbObservations:r.weekNbObservations,nbObsFullGrowth:r.weekNbObsFullGrowth,nbObsSlowGrowth:r.weekNbObsSlowGrowth,nbObsStoppedGrowth:r.weekNbObsStoppedGrowth,metricsDateInMs:(new Date).getTime()});case 2:return s.next=4,N.getObservations();case 4:a.posts=s.sent;case 5:case"end":return s.stop()}}),s)})))()}}},M=x,j=(r("e41a"),Object(h["a"])(M,b,m,!1,null,"780d9488",null)),S=j.exports,I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"footer"},[a("h1",[e._v(e._s(e.msg))]),a("img",{attrs:{alt:"Vue logo",src:r("cf05")}})])},_=[],Y={name:"Footer",data:function(){return{msg:"Place the footer here"}}},P=Y,L=(r("33e0"),Object(h["a"])(P,I,_,!1,null,"2e9ae21c",null)),T=L.exports,W={name:"App",components:{Menu:f,ApexMap:S,Footer:T},created:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{r=e.$store.state.loggedUserEmail,N.checkEMail(r).then((function(t){!0===t?N.getObservations(r).then((function(t){var r=N.extractUserDataObjFrom(t);N.addWeeksToUserDataObj(r),N.enforceConsistencyOfUserDataObj(r),N.sortUserDataObjByYearByWeek(r),e.$store.commit("initUserDataObj",r),console.log("updated $store.state.userDataObj: "),console.log(e.$store.state.userDataObj)})):console.log("mail is not valid")}))}catch(a){e.error=a.message}case 1:case"end":return t.stop()}}),t)})))()}},C=W,U=(r("034f"),Object(h["a"])(C,o,i,!1,null,null,null)),G=U.exports;a["a"].config.productionTip=!1,new a["a"]({store:n,render:function(e){return e(G)}}).$mount("#app")},"77d4":function(e,t,r){},"7c96":function(e,t,r){},"85ec":function(e,t,r){},bded:function(e,t,r){},cf05:function(e,t,r){e.exports=r.p+"img/logo.82b9c7a5.png"},d50c:function(e,t,r){"use strict";var a=r("bded"),s=r.n(a);s.a},e41a:function(e,t,r){"use strict";var a=r("7c96"),s=r.n(a);s.a}});
//# sourceMappingURL=app.7f80bbb3.js.map