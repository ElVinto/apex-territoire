(function(e){function r(r){for(var n,o,i=r[0],u=r[1],c=r[2],h=0,b=[];h<i.length;h++)o=i[h],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&b.push(a[o][0]),a[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);l&&l(r);while(b.length)b.shift()();return s.push.apply(s,c||[]),t()}function t(){for(var e,r=0;r<s.length;r++){for(var t=s[r],n=!0,i=1;i<t.length;i++){var u=t[i];0!==a[u]&&(n=!1)}n&&(s.splice(r--,1),e=o(o.s=t[0]))}return e}var n={},a={app:0},s=[];function o(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=n,o.d=function(e,r,t){o.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,r){if(1&r&&(e=o(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)o.d(t,n,function(r){return e[r]}.bind(null,n));return t},o.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(r,"a",r),r},o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=r,i=i.slice();for(var c=0;c<i.length;c++)r(i[c]);var l=u;s.push([0,"chunk-vendors"]),t()})({0:function(e,r,t){e.exports=t("56d7")},"034f":function(e,r,t){"use strict";var n=t("85ec"),a=t.n(n);a.a},"33e0":function(e,r,t){"use strict";var n=t("77d4"),a=t.n(n);a.a},"56d7":function(e,r,t){"use strict";t.r(r);t("e260"),t("e6cf"),t("cca6"),t("a79d");var n=t("2b0e"),a=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{attrs:{id:"app"}},[t("Menu",{attrs:{msg:"Place the menu here"}}),t("ApexMap",{attrs:{userId:"14"}}),t("Footer")],1)},s=[],o=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"menu"},[t("h1",[e._v(e._s(e.msg))])])},i=[],u={name:"Menu",props:{msg:String},data:function(){return{tabs:["map","summary","export"]}}},c=u,l=(t("d50c"),t("2877")),h=Object(l["a"])(c,o,i,!1,null,"1e479e26",null),b=h.exports,v=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"apex-map"},[t("h1",[e._v(e._s(e.userId))])])},p=[],f=(t("96cf"),t("1da1")),d=(t("7db0"),t("4160"),t("d3b7"),t("25f0"),t("159b"),t("d4ec")),w=t("bee2"),g=t("7338"),m=t.n(g);t("ed18").config();var k="db-services";var y=function(){function e(){Object(d["a"])(this,e)}return Object(w["a"])(e,null,[{key:"getObservations",value:function(e){return new Promise((function(r,t){try{var n={params:{userId:e}};m.a.get(k,n).then((function(e){r(e.data)}))}catch(a){t(a)}}))}},{key:"postQuery",value:function(e){return m.a.post(k,e)}},{key:"deleteQuery",value:function(e){return m.a.delete(k,e)}},{key:"getMonthLabel",value:function(e){switch(e){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec";default:return}}},{key:"getDayLabel",value:function(e){switch(e){case"1":return"Mon";case"2":return"Tue";case"3":return"Wed";case"4":return"Thu";case"5":return"Fri";case"6":return"Sat";case"0":return"Sun";default:return}}},{key:"extractUserDataObjFrom",value:function(r){var t={};return r.forEach((function(r){void 0===t.userName&&(t.userName=r.userName,t.parcels=[]);var n=t.parcels.find((function(e){return e.parcelName===r.parcelName}));void 0===n&&(n=new e.MonitoredParcel(r.parcelName,r.ownerName,{lat:r.parcelLat,lng:r.parcelLng}),t.parcels.push(n));var a=new Date;a.setTime(r.sessionDateInSec+"000");var s=a.getFullYear(),o=n.parcelYears.find((function(e){return e.yearNumber===s}));void 0===o&&(o=new e.MonitoredYear(s),n.parcelYears.push(o),console.log("INIT YEAR IF NEEDED"));var i=new Date(s,0,1),u=864e5,c=u*(1===i.getDay()?0:0===i.getDay()?1:8-i.getDay()),l=new Date;l.setTime(i.getTime()+c);var h=a.getTime()===l.getTime()?1:Math.ceil((a.getTime()-l.getTime())/u/7),b=a.getTime()-u*(1===a.getDay()?0:0===a.getDay()?6:a.getDay()-1),v=new Date;v.setTime(b);var p=o.yearWeeks.find((function(e){return e.weekNumber===h}));void 0===p&&(p=new e.MonitoredWeek(r.sessionDateInSec+"000"),o.yearWeeks.push(p));var f=p.weekSessions.find((function(e){return e.sessionDateInMs===r.sessionDateInSec+"000"}));void 0===f&&(f=new e.MonitoredSession(r.sessionDateInSec+"000"),p.weekSessions.push(f));var d=new e.MonitoredObservation(r.obsvLabel,r.obsvDateInMs,r.ownerName,r.oUserName,{lat:r.obsvLat,lng:r.obsvLng});f.sessionObservations.push(d)})),console.log("extracted userDataObj"),console.log(t),t}},{key:"addWeeksToUserDataObj",value:function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2018,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2019,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:22,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:32;if(console.log("addWeeksToUserDataObj "),void 0===r.parcels)throw" No parcels is currently monitored by the user";for(var o=[],i=[],u=0;u<r.parcels.length;u++){var c=r.parcels[u];if(void 0!==c.parcelYears)for(var l=function(e){var r=c.parcelYears[e].yearNumber;void 0===o.find((function(e){return e===r}))&&o.push(r)},h=0;h<c.parcelYears.length;h++)l(h);for(var b=function(e){void 0===o.find((function(r){return r===e}))&&o.push(e)},v=t;v<=n;v++)b(v);if(void 0!==c.parcelYears)for(var p=0;p<c.parcelYears.length;p++)if(void 0!==c.parcelYears[p].yearWeeks)for(var f=function(e){var r=c.parcelYears[p].yearWeeks[e].weekNumber;void 0===i.find((function(e){return e===r}))&&i.push(r)},d=0;d<c.parcelYears[p].yearWeeks.length;d++)f(d);for(var w=function(e){void 0===i.find((function(r){return r===e}))&&i.push(e)},g=a;g<=s;g++)w(g)}for(var m=0;m<r.parcels.length;m++)for(var k=r.parcels[m],y=function(r){var t=o[r],n=k.parcelYears.find((function(e){return e.yearNumber===t}));void 0===n&&(n=new e.MonitoredYear(t),k.parcelYears.push(n),console.log(" new year added "+n+" to "+k));for(var a=function(r){var a=i[r],s=n.yearWeeks.find((function(e){return e.weekNumber===a}));void 0===s&&(s=new e.MonitoredWeek(t,a),n.yearWeeks.push(s))},s=0;s<i.length;s++)a(s)},D=0;D<o.length;D++)y(D);console.log(" updated userDataObj"),console.log(r)}},{key:"enforceConsistencyOfUserDataObj",value:function(e){if(console.log(" enforceConsistencyOfUserDataObj "),void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var r=0;r<e.parcels.length;r++){var t=e.parcels[r];if(console.log(" parcelName "+t.parcelName),void 0!==t.parcelYears&&t.parcelYears.length>0)for(var n=0;n<t.parcelYears.length;n++){var a=t.parcelYears[n];if(console.log(" yearNumber "+a.yearNumber),void 0!==a.yearWeeks&&a.yearWeeks.length>0)for(var s=0;s<a.yearWeeks.length;s++){var o=a.yearWeeks[s];if(console.log(" weekNumber "+o.weekNumber),void 0!==o.weekSessions&&o.weekSessions.length>0){var i=0,u=0,c=0,l=0,h=0;this.weekICApex=0;for(var b=0;b<o.weekSessions.length;b++){var v=o.weekSessions[b],p=0,f=0;if(void 0!==v.sessionObservations){for(var d=0;d<v.sessionObservations.length;d++){var w=v.sessionObservations[d];"P"===w.obsvLabel&&c++,"R"===w.obsvLabel&&l++,"C"===w.obsvLabel&&h++,p+=w.obsvValue,f++,u+=w.obsvValue,i++}f>0&&(v.sessionAVGrowth=p/f)}}o.weekNbObservations=i,o.weekNbObsFullGrowth=c,o.weekNbObsSlowGrowth=l,o.weekNbObsStoppedGrowth=h,o.weekAVGrowth=Math.round(100*u/i)/100,o.weekPrctFullGrowth=Math.round(1e4*c/i)/100,o.weekPrctSlowGrowth=Math.round(1e4*l/i)/100,o.weekPrctStoppedGrowth=Math.round(1e4*h/i)/100,o.weekICApex=o.reInitICApex()}}}}console.log(" updated userDataObj "),console.log(e)}},{key:"sortUserDataObjByYearByWeek",value:function(e){if(void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var r=0;r<e.parcels.length;r++){var t=e.parcels[r];if(void 0!==t.parcelYears&&t.parcelYears.length>0){for(var n=0;n<t.parcelYears.length;n++){var a=t.parcelYears[n];void 0!==a.yearWeeks&&a.yearWeeks.length>0&&a.yearWeeks.sort((function(e,r){return e.weekNumber-r.weekNumber}))}t.parcelYears.sort((function(e,r){return e.yearNumber-r.yearNumber}))}}}},{key:"MonitoredParcel",value:function(e,r,t){var n=this;this.parcelName=e,this.parcelOwner=r,this.parcelCoord=t,this.parcelYears=[],this.toString=function(){return"parcel:"+n.parcelName}}},{key:"MonitoredYear",value:function(e){this.yearNumber=e,this.yearWeeks=[],this.toString=function(){return"y"+this.yearNumber}}},{key:"MonitoredWeek",value:function(r,t){var n=this;if(this.weekNumber=0,this.weekLabel="",this.weekFullDate=new Date,this.weekSessions=[],this.weekNbObservations=0,this.weekNbObsFullGrowth=0,this.weekNbObsSlowGrowth=0,this.weekNbObsStoppedGrowth=0,this.weekPrctFullGrowth=0,this.weekPrctSlowGrowth=0,this.weekPrctStoppedGrowth=0,this.weekAVGrowth=0,this.weekICApex=0,this.toString=function(){return"w"+n.weekNumber+"("+n.weekLabel+")"},void 0===t){var a=r;console.log(" building MonitoredWeek with date in ms "+r);var s=new Date;s.setTime(a);var o=new Date(s.getFullYear(),0,1),i=864e5,u=i*(1===o.getDay()?0:0===o.getDay()?1:8-o.getDay()),c=new Date;c.setTime(o.getTime()+u);var l=s.getTime()===c.getTime()?1:Math.ceil((s.getTime()-c.getTime())/i/7),h=s.getTime()-i*(1===s.getDay()?0:0===s.getDay()?6:s.getDay()-1),b=new Date;b.setTime(h);var v=b.getDate()+" "+e.getMonthLabel(b.getMonth());this.weekNumber=l,this.weekLabel=v,this.weekFullDate=b.toString()}else{var p=r,f=t;console.log("building MonitoredWeek with yearNumber: "+p+" and wNumber "+t);var d=new Date(p,0,1),w=864e5,g=w*(1===d.getDay()?0:0===d.getDay()?1:8-d.getDay()),m=new Date;m.setTime(d.getTime()+g);var k=m.getTime()+7*w*(f-1),y=new Date;y.setTime(k);var D=y.getDate()+" "+e.getMonthLabel(y.getMonth());this.weekNumber=f,this.weekLabel=D,this.weekFullDate=y.toString()}this.reInitICApex=function(){var e=3;return this.weekAVGrowth>=.75?e=0:this.weekPrctFullGrowth>=5?e=1:this.weekPrctSlowGrowth<=90&&(e=2),e}}},{key:"MonitoredSession",value:function(r){var t=new Date;t.setTime(r),this.sessionDateInMs=r,this.sessionDateLabel=t.getDate()+" "+e.getMonthLabel(t.getMonth())+" "+t.getFullYear(),this.sessionAVGrowth=0,this.sessionICApex=0,this.sessionObservations=[]}},{key:"MonitoredObservation",value:function(e,r,t,n,a){this.initObsvValueFromLabel=function(e){switch(e){case"P":return 1;case"R":return.5;case"C":return 0;default:return}},this.obsvLabel=e,this.obsvValue=this.initObsvValueFromLabel(e),this.obsvDateInMs=r,this.obsvOwnerName=t,this.obsvUserName=n,this.obsvCoord=a}}]),e}(),D=y,O={name:"ApexMap",props:{userId:String},data:function(){return{userDataObj:{},error:"",text:""}},created:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,D.getObservations(e.userId);case 3:t=r.sent,e.userDataObj=D.extractUserDataObjFrom(t),D.addWeeksToUserDataObj(e.userDataObj),D.enforceConsistencyOfUserDataObj(e.userDataObj),D.sortUserDataObjByYearByWeek(e.userDataObj),console.log("userDataObj"),console.log(e.userDataObj),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](0),e.error=r.t0.message;case 15:case"end":return r.stop()}}),r,null,[[0,12]])})))()},methods:{updateWeekMetrics:function(e,r,t){var n=this;return Object(f["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,D.postQuery({transaction:"update",dbUserID:e.userDBID,dbParcelId:e.parcelDBId,yearNumber:r.yearNumber,weekNumber:t.weekNumber,weekLabel:t.weekLabel,nbObservations:t.weekNbObservations,nbObsFullGrowth:t.weekNbObsFullGrowth,nbObsSlowGrowth:t.weekNbObsSlowGrowth,NbObsStoppedGrowth:t.weekNbObsStoppedGrowth,metricsDateInMs:(new Date).getTime()});case 2:return a.next=4,D.getObservations();case 4:n.posts=a.sent;case 5:case"end":return a.stop()}}),a)})))()}}},N=O,M=(t("b781"),Object(l["a"])(N,v,p,!1,null,"3445f829",null)),S=M.exports,j=function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("div",{staticClass:"footer"},[n("h1",[e._v(e._s(e.msg))]),n("img",{attrs:{alt:"Vue logo",src:t("cf05")}})])},T=[],x={name:"Footer",data:function(){return{msg:"Place the footer here"}}},Y=x,I=(t("33e0"),Object(l["a"])(Y,j,T,!1,null,"2e9ae21c",null)),W=I.exports;console.log(b.props);var G={name:"App",components:{Menu:b,ApexMap:S,Footer:W}},F=G,L=(t("034f"),Object(l["a"])(F,a,s,!1,null,null,null)),P=L.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(e){return e(P)}}).$mount("#app")},"77d4":function(e,r,t){},"85ec":function(e,r,t){},b781:function(e,r,t){"use strict";var n=t("fe79"),a=t.n(n);a.a},bded:function(e,r,t){},cf05:function(e,r,t){e.exports=t.p+"img/logo.82b9c7a5.png"},d50c:function(e,r,t){"use strict";var n=t("bded"),a=t.n(n);a.a},fe79:function(e,r,t){}});
//# sourceMappingURL=app.1afd9585.js.map