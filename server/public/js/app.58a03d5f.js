(function(e){function r(r){for(var a,o,i=r[0],u=r[1],c=r[2],p=0,h=[];p<i.length;p++)o=i[p],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&h.push(n[o][0]),n[o]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);l&&l(r);while(h.length)h.shift()();return s.push.apply(s,c||[]),t()}function t(){for(var e,r=0;r<s.length;r++){for(var t=s[r],a=!0,i=1;i<t.length;i++){var u=t[i];0!==n[u]&&(a=!1)}a&&(s.splice(r--,1),e=o(o.s=t[0]))}return e}var a={},n={app:0},s=[];function o(r){if(a[r])return a[r].exports;var t=a[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=a,o.d=function(e,r,t){o.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,r){if(1&r&&(e=o(e)),8&r)return e;if(4&r&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)o.d(t,a,function(r){return e[r]}.bind(null,a));return t},o.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(r,"a",r),r},o.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=r,i=i.slice();for(var c=0;c<i.length;c++)r(i[c]);var l=u;s.push([0,"chunk-vendors"]),t()})({0:function(e,r,t){e.exports=t("56d7")},"034f":function(e,r,t){"use strict";var a=t("85ec"),n=t.n(a);n.a},"1c9b":function(e,r,t){"use strict";var a=t("81d0"),n=t.n(a);n.a},"33e0":function(e,r,t){"use strict";var a=t("77d4"),n=t.n(a);n.a},"56d7":function(e,r,t){"use strict";t.r(r);t("e260"),t("e6cf"),t("cca6"),t("a79d");var a=t("2b0e"),n=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{attrs:{id:"app"}},[t("Menu",{attrs:{msg:"Place the menu here"}}),t("hr"),t("ApexMap",{attrs:{userId:"14"}}),t("hr"),t("Footer")],1)},s=[],o=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"menu"},[t("h1",[e._v(e._s(e.msg))])])},i=[],u={name:"Menu",props:{msg:String},data:function(){return{tabs:["map","summary","export"]}}},c=u,l=(t("d50c"),t("2877")),p=Object(l["a"])(c,o,i,!1,null,"1e479e26",null),h=p.exports,v=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"apex-map"},[t("h1",[e._v(" userId "+e._s(e.userId))]),t("div",{staticClass:"parcels-container"},[e._l(e.userDataObj.parcels,(function(r,a){return t("div",{key:r.parcelName,staticClass:"parcels",attrs:{item:r,index:a}},[t("p",{staticClass:"text"},[e._v(e._s("parcelName: "+r.parcelName+" parcelOwner: "+r.parcelOwner+" monitored years:["+r.parcelYears+"]"))])])})),e._v(" Todo add the map ")],2)])},f=[],b=(t("96cf"),t("1da1")),d=(t("7db0"),t("4160"),t("d3b7"),t("25f0"),t("159b"),t("d4ec")),w=t("bee2"),g=t("7338"),m=t.n(g);t("ed18").config();var k="db-services";var y=function(){function e(){Object(d["a"])(this,e)}return Object(w["a"])(e,null,[{key:"getObservations",value:function(e){return new Promise((function(r,t){try{var a={params:{userId:e}};m.a.get(k,a).then((function(e){r(e.data)}))}catch(n){t(n)}}))}},{key:"postQuery",value:function(e){return m.a.post(k,e)}},{key:"deleteQuery",value:function(e){return m.a.delete(k,e)}},{key:"getMonthLabel",value:function(e){switch(e){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec";default:return}}},{key:"getDayLabel",value:function(e){switch(e){case"1":return"Mon";case"2":return"Tue";case"3":return"Wed";case"4":return"Thu";case"5":return"Fri";case"6":return"Sat";case"0":return"Sun";default:return}}},{key:"extractUserDataObjFrom",value:function(r){console.log("extractUserDataObjFrom ");var t={};return r.forEach((function(r){void 0===t.userName&&(t.userName=r.userName,t.parcels=[]);var a=t.parcels.find((function(e){return e.parcelName===r.parcelName}));void 0===a&&(a=new e.MonitoredParcel(r.parcelName,r.ownerName,{lat:r.parcelLat,lng:r.parcelLng}),t.parcels.push(a));var n=new Date;n.setTime(r.sessionDateInSec+"000");var s=n.getFullYear(),o=a.parcelYears.find((function(e){return e.yearNumber===s}));void 0===o&&(o=new e.MonitoredYear(s),a.parcelYears.push(o),console.log("INIT YEAR IF NEEDED"));var i=new Date(s,0,1),u=864e5,c=u*(1===i.getDay()?0:0===i.getDay()?1:8-i.getDay()),l=new Date;l.setTime(i.getTime()+c);var p=n.getTime()===l.getTime()?1:Math.ceil((n.getTime()-l.getTime())/u/7),h=n.getTime()-u*(1===n.getDay()?0:0===n.getDay()?6:n.getDay()-1),v=new Date;v.setTime(h);var f=o.yearWeeks.find((function(e){return e.weekNumber===p}));void 0===f&&(f=new e.MonitoredWeek(r.sessionDateInSec+"000"),o.yearWeeks.push(f));var b=f.weekSessions.find((function(e){return e.sessionDateInMs===r.sessionDateInSec+"000"}));void 0===b&&(b=new e.MonitoredSession(r.sessionDateInSec+"000"),f.weekSessions.push(b));var d=new e.MonitoredObservation(r.obsvLabel,r.obsvDateInMs,r.ownerName,r.oUserName,{lat:r.obsvLat,lng:r.obsvLng});b.sessionObservations.push(d)})),t}},{key:"addWeeksToUserDataObj",value:function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2018,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2019,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:22,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:32;if(console.log("addWeeksToUserDataObj "),void 0===r.parcels)throw" No parcels is currently monitored by the user";for(var o=[],i=[],u=0;u<r.parcels.length;u++){var c=r.parcels[u];if(void 0!==c.parcelYears)for(var l=function(e){var r=c.parcelYears[e].yearNumber;void 0===o.find((function(e){return e===r}))&&o.push(r)},p=0;p<c.parcelYears.length;p++)l(p);for(var h=function(e){void 0===o.find((function(r){return r===e}))&&o.push(e)},v=t;v<=a;v++)h(v);if(void 0!==c.parcelYears)for(var f=0;f<c.parcelYears.length;f++)if(void 0!==c.parcelYears[f].yearWeeks)for(var b=function(e){var r=c.parcelYears[f].yearWeeks[e].weekNumber;void 0===i.find((function(e){return e===r}))&&i.push(r)},d=0;d<c.parcelYears[f].yearWeeks.length;d++)b(d);for(var w=function(e){void 0===i.find((function(r){return r===e}))&&i.push(e)},g=n;g<=s;g++)w(g)}for(var m=0;m<r.parcels.length;m++)for(var k=r.parcels[m],y=function(r){var t=o[r],a=k.parcelYears.find((function(e){return e.yearNumber===t}));void 0===a&&(a=new e.MonitoredYear(t),k.parcelYears.push(a));for(var n=function(r){var n=i[r],s=a.yearWeeks.find((function(e){return e.weekNumber===n}));void 0===s&&(s=new e.MonitoredWeek(t,n),a.yearWeeks.push(s))},s=0;s<i.length;s++)n(s)},O=0;O<o.length;O++)y(O)}},{key:"enforceConsistencyOfUserDataObj",value:function(e){if(console.log(" enforceConsistencyOfUserDataObj "),void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var r=0;r<e.parcels.length;r++){var t=e.parcels[r];if(void 0!==t.parcelYears&&t.parcelYears.length>0)for(var a=0;a<t.parcelYears.length;a++){var n=t.parcelYears[a];if(void 0!==n.yearWeeks&&n.yearWeeks.length>0)for(var s=0;s<n.yearWeeks.length;s++){var o=n.yearWeeks[s];if(void 0!==o.weekSessions&&o.weekSessions.length>0){var i=0,u=0,c=0,l=0,p=0;this.weekICApex=0;for(var h=0;h<o.weekSessions.length;h++){var v=o.weekSessions[h],f=0,b=0;if(void 0!==v.sessionObservations){for(var d=0;d<v.sessionObservations.length;d++){var w=v.sessionObservations[d];"P"===w.obsvLabel&&c++,"R"===w.obsvLabel&&l++,"C"===w.obsvLabel&&p++,f+=w.obsvValue,b++,u+=w.obsvValue,i++}b>0&&(v.sessionAVGrowth=f/b)}}o.weekNbObservations=i,o.weekNbObsFullGrowth=c,o.weekNbObsSlowGrowth=l,o.weekNbObsStoppedGrowth=p,o.weekAVGrowth=Math.round(100*u/i)/100,o.weekPrctFullGrowth=Math.round(1e4*c/i)/100,o.weekPrctSlowGrowth=Math.round(1e4*l/i)/100,o.weekPrctStoppedGrowth=Math.round(1e4*p/i)/100,o.weekICApex=o.reInitICApex()}}}}}},{key:"sortUserDataObjByYearByWeek",value:function(e){if(void 0===e.parcels)throw" No parcels is currently monitored by the user";for(var r=0;r<e.parcels.length;r++){var t=e.parcels[r];if(void 0!==t.parcelYears&&t.parcelYears.length>0){for(var a=0;a<t.parcelYears.length;a++){var n=t.parcelYears[a];void 0!==n.yearWeeks&&n.yearWeeks.length>0&&n.yearWeeks.sort((function(e,r){return e.weekNumber-r.weekNumber}))}t.parcelYears.sort((function(e,r){return e.yearNumber-r.yearNumber}))}}}},{key:"MonitoredParcel",value:function(e,r,t){var a=this;this.parcelName=e,this.parcelOwner=r,this.parcelCoord=t,this.parcelYears=[],this.toString=function(){return"parcel: "+a.parcelName}}},{key:"MonitoredYear",value:function(e){this.yearNumber=e,this.yearWeeks=[],this.toString=function(){return"year: ".concat(this.yearNumber)}}},{key:"MonitoredWeek",value:function(r,t){var a=this;if(this.weekNumber=0,this.weekLabel="",this.weekFullDate=new Date,this.weekSessions=[],this.weekNbObservations=0,this.weekNbObsFullGrowth=0,this.weekNbObsSlowGrowth=0,this.weekNbObsStoppedGrowth=0,this.weekPrctFullGrowth=0,this.weekPrctSlowGrowth=0,this.weekPrctStoppedGrowth=0,this.weekAVGrowth=0,this.weekICApex=0,this.toString=function(){return"w"+a.weekNumber+"("+a.weekLabel+")"},void 0===t){var n=r,s=new Date;s.setTime(n);var o=new Date(s.getFullYear(),0,1),i=864e5,u=i*(1===o.getDay()?0:0===o.getDay()?1:8-o.getDay()),c=new Date;c.setTime(o.getTime()+u);var l=s.getTime()===c.getTime()?1:Math.ceil((s.getTime()-c.getTime())/i/7),p=s.getTime()-i*(1===s.getDay()?0:0===s.getDay()?6:s.getDay()-1),h=new Date;h.setTime(p);var v=h.getDate()+" "+e.getMonthLabel(h.getMonth());this.weekNumber=l,this.weekLabel=v,this.weekFullDate=h.toString()}else{var f=r,b=t,d=new Date(f,0,1),w=864e5,g=w*(1===d.getDay()?0:0===d.getDay()?1:8-d.getDay()),m=new Date;m.setTime(d.getTime()+g);var k=m.getTime()+7*w*(b-1),y=new Date;y.setTime(k);var O=y.getDate()+" "+e.getMonthLabel(y.getMonth());this.weekNumber=b,this.weekLabel=O,this.weekFullDate=y.toString()}this.reInitICApex=function(){var e=3;return this.weekAVGrowth>=.75?e=0:this.weekPrctFullGrowth>=5?e=1:this.weekPrctSlowGrowth<=90&&(e=2),e}}},{key:"MonitoredSession",value:function(r){var t=new Date;t.setTime(r),this.sessionDateInMs=r,this.sessionDateLabel=t.getDate()+" "+e.getMonthLabel(t.getMonth())+" "+t.getFullYear(),this.sessionAVGrowth=0,this.sessionICApex=0,this.sessionObservations=[]}},{key:"MonitoredObservation",value:function(e,r,t,a,n){this.initObsvValueFromLabel=function(e){switch(e){case"P":return 1;case"R":return.5;case"C":return 0;default:return}},this.obsvLabel=e,this.obsvValue=this.initObsvValueFromLabel(e),this.obsvDateInMs=r,this.obsvOwnerName=t,this.obsvUserName=a,this.obsvCoord=n}}]),e}(),O=y,D={name:"ApexMap",props:{userId:String},data:function(){return{userDataObj:{},error:"",text:""}},created:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function r(){var t;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,O.getObservations(e.userId);case 3:t=r.sent,e.userDataObj=O.extractUserDataObjFrom(t),O.addWeeksToUserDataObj(e.userDataObj),O.enforceConsistencyOfUserDataObj(e.userDataObj),O.sortUserDataObjByYearByWeek(e.userDataObj),console.log("userDataObj"),console.log(e.userDataObj),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](0),e.error=r.t0.message;case 15:case"end":return r.stop()}}),r,null,[[0,12]])})))()},methods:{updateWeekMetrics:function(e,r,t){var a=this;return Object(b["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,O.postQuery({transaction:"update_WeekMetrics",userId:e.userDBId,parcelId:e.parcelDBId,yearNumber:r.yearNumber,weekNumber:t.weekNumber,weekLabel:t.weekLabel,nbObservations:t.weekNbObservations,nbObsFullGrowth:t.weekNbObsFullGrowth,nbObsSlowGrowth:t.weekNbObsSlowGrowth,nbObsStoppedGrowth:t.weekNbObsStoppedGrowth,metricsDateInMs:(new Date).getTime()});case 2:return n.next=4,O.getObservations();case 4:a.posts=n.sent;case 5:case"end":return n.stop()}}),n)})))()}}},N=D,M=(t("1c9b"),Object(l["a"])(N,v,f,!1,null,"c9d1e7d2",null)),S=M.exports,j=function(){var e=this,r=e.$createElement,a=e._self._c||r;return a("div",{staticClass:"footer"},[a("h1",[e._v(e._s(e.msg))]),a("img",{attrs:{alt:"Vue logo",src:t("cf05")}})])},x=[],T={name:"Footer",data:function(){return{msg:"Place the footer here"}}},Y=T,I=(t("33e0"),Object(l["a"])(Y,j,x,!1,null,"2e9ae21c",null)),W=I.exports;console.log(h.props);var G={name:"App",components:{Menu:h,ApexMap:S,Footer:W}},_=G,F=(t("034f"),Object(l["a"])(_,n,s,!1,null,null,null)),L=F.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(L)}}).$mount("#app")},"77d4":function(e,r,t){},"81d0":function(e,r,t){},"85ec":function(e,r,t){},bded:function(e,r,t){},cf05:function(e,r,t){e.exports=t.p+"img/logo.82b9c7a5.png"},d50c:function(e,r,t){"use strict";var a=t("bded"),n=t.n(a);n.a}});
//# sourceMappingURL=app.58a03d5f.js.map